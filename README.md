# exercises

### install
install miniconda
conda create -n exerc python=3.11
conda activate exerc

conda install jupyterlab -c conda-forge
conda install -c conda-forge obspy
conda install nodejs
conda install cartopy -c conda-forge
conda install ipysheet -c conda-forge
conda install bokeh -c conda-forge

**option**
conda install -c conda-forge pywavelets
conda install -c conda-forge pygmt
conda install -c conda-forge pyqtgraph

run jupyter-lab

### 采样定理、奈奎斯特频率和混叠
```
1） 原始的奈奎斯特频率是10 Hz。新的频率是5 Hz。
2） 在时域中，下采样信号（红色）的周期性更长（低频），但最大幅度保持不变。在频域中，原始数据显示在4Hz和8Hz处有两个峰值，这是用于创建信号的发生器频率。下采样数据也显示了两个峰值，但分别位于2Hz和4Hz，幅度要小得多。8Hz的峰值无法再分辨出来，因为它高于新的奈奎斯特频率5Hz。由于在下采样之前没有从数据中去除8Hz的能量，所以它被“映射”到了2Hz的错误频率。我们还失去了8Hz峰值的能量/幅度。因此，2Hz峰值的错误频率受到4Hz峰值的“供给”。因此，我们无法解析4Hz峰值的完整幅度。我们不仅扭曲了信号的频率内容，还扭曲了幅度。这种效应叫做混叠。在实际数据中无法区分这个错误，而且无法逆转。一旦您在低通滤波之前对数据进行了下采样，它们就会被破坏，您甚至都不会意识到。这可能导致完全错误的解释。
3） 我们已经去除了高于新奈奎斯特频率的所有能量。因此，在频域中，我们只能看到剩下的原始频率4Hz处的一个峰值，其幅度完全保持原样。
```
### 频谱泄漏
4) 由于信号是由单一频率产生的，我们应该在该频率的图中得到一个delta脉冲。相反，我们得到了一个三角形，表明部分能量/幅度分布在4Hz的中心频率附近。这就是所谓的频谱泄漏，即中心频率的“模糊”。原因在于傅里叶变换，它假设信号是无限的。信号的有限长度限制了频率间距：Δf=1/T。
5) 时域信号越长，频率峰值越明显。时域中长信号意味着频域中的良好分辨率，反之亦然。这也被称为不确定性原理。
6) 通过在时域中对信号进行零填充（即在信号的开头和结尾添加幅度为零的额外样本）来人为地增加信号的长度。因此，我们不是添加信息（其他频率），而只是增加信号的长度，从而提高频率分辨率。

### 时频图，频谱图
7) 以256个样本的初始值，我们只能看到垂直线，因此只能确定预期高幅度的时刻。我们无法说这些高幅度出现在哪些频率。当我们将样本点数增加到，比如说NFFT=32768时，情况恰恰相反。我们现在看到水平线，也就是说我们可以清楚地定义频率，但不能确定它们出现的时刻。这再次是不确定性原理。通过增加用于生成频谱图的FFT的样本数并保持信号的时间长度不变，我们减小了Δf并增加了频域中的分辨率。
8) 时间窗口越长，我们看到的第一次到达的开始时间越清晰。为了使Δf变小，即在频域中获得良好的分辨率，我们需要高周期T，即我们需要在时域中的长信号。
9) 当我们将时间窗口设置在例如3500到8500秒之间，并将样本数增加到例如2048时，我们可以看到最高幅度的频率发生了变化。我们得到了从低频到高频的曲线。这是地表波的频散，仅仅是频谱图有用的一个应用。

### 窗口和锥形
10) 实际数据通常不会以与开始时相同的样本幅度结束。最迟在切割数据时就会出现这种情况。当将数据转换为频域时，我们因此会产生一个不连续的现象，这会产生吉布斯效应。在之后对数据进行过滤时也会出现问题。因此，我们需要将最后一个样本幅度调整为与第一个样本相同的值，传统上为零。
这就是锥形所做的：逐渐将信号开头和结尾的几个样本减小到零。锥形是一种在时域中应用的窗口函数，即逐个样本地乘以数据。
11) 锥形的百分比定义了信号开头和结尾受锥形影响的样本数。例如，当一个具有100个样本的信号被锥形10%时，第一个和最后一个10个样本的幅度逐渐减小，直到达到零。在中间，锥形值为1，因此根本不改变样本幅度。在中间，信号保持不变。
12) 锥形的斜率变得更加平缓，更多的样本受到锥形的影响。这也意味着，我们正在“丢弃”部分信号，从而丢失信息。
应用锥形始终是在尽可能保留信息（低锥形百分比）和使幅度减小尽可能平缓（高锥形百分比）之间的平衡。如果减小幅度不够平缓，我们可能会在后面再次遇到问题，例如当我们想要过滤数据时。原因是过滤是在频域中完成的。粗糙的幅度减小到零类似于数据中的不连续，我们又回到了吉布斯现象。

### 去均值/去趋势
13) 在单元格7中，数据具有偏移，它们的中位幅度没有达到零。在过滤数据时，这会在轨迹开始处引入跳跃，然后在整个轨迹中引入指数衰减。通过去均值，我们从数据中减去偏移，过滤后的轨迹看起来很漂亮。
在单元格8中，数据呈线性趋势，在过滤过程中导致数据弯曲。
在单元格9中，数据被更复杂的多项式形状趋势破坏。
14) 几乎总是（预）处理包括在频域中执行的步骤，数据需要通过傅里叶变换进行转换。我们需要确保我们的数据没有不连续性（吉布斯效应！）并且我们的数据足够长以适应这种变换的性质。

### 信噪比计算
SNR = 10 * log10(有用信号能量 / 噪声能量)

计算噪声能量的方法通常取决于噪声的性质和特点。以下是一些常见的计算噪声能量的方法：
1) 空间或时间上的背景噪声估计：对于某些应用场景，可以通过在不包含有用信号的区域进行观测或采样来估计背景噪声的能量。在这种情况下，通常是波形振幅的平方和，也可以计算噪声能量的平均值或总和作为噪声能量的估计。
2) 统计分析方法：如果噪声是随机的且符合特定的统计分布（如高斯分布），可以使用统计分析方法来估计噪声能量。这可能涉及计算噪声样本的方差、标准差或相关统计量作为噪声能量的度量。
3) 频域分析方法：对于一些噪声类型，特别是具有明显频率特征的噪声，可以使用频域分析方法来计算噪声能量。这可能涉及将噪声信号转换到频域（如应用傅里叶变换），然后计算特定频率范围内的能量或功率。
需要注意的是，噪声能量的计算方法会根据具体的应用和噪声特性而有所不同。在实际应用中，可能需要根据具体情况选择适当的方法来计算噪声能量，并确保准确度和可靠性。

### 傅里叶级数和傅里叶系数的关系
傅里叶系数和傅里叶级数之间有密切的关系。傅里叶级数是一种将周期信号表示为正弦波和余弦波之和的方法。傅里叶级数的形式如下：

f(t) = a0 + ∑[an * cos(nωt) + bn * sin(nωt)]

其中，f(t) 是周期信号，ω 是角频率，n 是整数，表示各个正弦和余弦波的序号。

傅里叶系数就是这个级数中的系数，包括 a0、an 和 bn。它们分别表示直流分量（a0）和各个频率成分的振幅。傅里叶系数可以通过傅里叶变换从原始信号中计算得到，具体计算公式如下：

a0 = (1/T) ∫[f(t) * 1] dt （积分区间为一个周期T）

an = (2/T) ∫[f(t) * cos(nωt)] dt （积分区间为一个周期T）

bn = (2/T) ∫[f(t) * sin(nωt)] dt （积分区间为一个周期T）

总之，傅里叶级数是将周期信号表示为正弦波和余弦波之和的方法，而傅里叶系数则是这些正弦波和余弦波的振幅



https://github.com/calum-chamberlain/GPHS445_notebooks

https://github.com/calum-chamberlain/ESCI203_notebooks/tree/master

https://github.com/mbagagli/filterpicker/tree/master
